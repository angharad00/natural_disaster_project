---
title: "Project"
output:
  html_document: default
  pdf_document: default
  word_document: default
date: "2024-02-29"
---

```{r setup, include = FALSE, echo=FALSE}
knitr::opts_chunk$set(
	message = FALSE,
	warning = FALSE
)
library(here)
library(tidyverse)
library(dplyr)
library(stringr)
library(plotly)
library(ggplot2)
library(ggrepel)
 
```





```{r include=FALSE}
# read in data 
data <- here("data","emdat.csv") %>% read_csv()
head(data)



# select columns relevant to research question 

my_data <- data %>% select(c(Historic, DisNo., Historic, `Classification Key`, `Disaster Group`, `Disaster Subgroup`, `Disaster Type`, `Disaster Subtype`, ISO, Country, Subregion, Region, Location, `Start Year`, `Start Month`, `Start Day`))

view(my_data)

```



```{r include=FALSE}
# tidy the names of the columns so its in a better format 
#changing the names so there are no spaces or capital letter

my_data <- my_data %>% rename(id = DisNo.,
                   historic = Historic,
                   classification = `Classification Key`,
                   group = `Disaster Group`,
                   subgroup = `Disaster Subgroup`,
                   type = `Disaster Type`,
                   subtype = `Disaster Subtype`,
                   iso = ISO,
                   country = Country,
                   subregion = Subregion,
                   region = Region,
                   location = Location,
                   year = `Start Year`,
                   month = `Start Month`,
                   day = `Start Day`)

#make sure the class is correct for every variable 
str(my_data)


#change the class to numeric for year, month and day variable
my_data <- my_data %>% mutate(year = as.numeric(year),
                   month = as.numeric(month),
                   day = as.numeric(day))


#looking at first few lines 
head(my_data)


```



```{r include=FALSE}
# starting to explore the data over time

#total number of disasters per year
my_data %>% group_by(year) %>% summarise(count = n())
#looks as if the data from before the 90s was markedly lower - it is unlikely due to changes in the environment rather changes in recording quaility of natural disasters over time - need to view this better in a graph.

count_year <- my_data %>% group_by(year) %>% summarise(count = n())

ggplot(count_year, aes(x = year, y = count)) +
  geom_bar(stat = "identity") +
  xlim(1980, 2023)


#remove any Historic data point 
updated_data <- my_data %>% filter(historic == "No")
view(updated_data)

```

```{r include=FALSE}
#make a new column which categories the type of natural disaster as direct effect of climate change, indirect effect of climate change and not related

# Define vectors of natural disasters classified as primary and secondary effects of climate change
primary_effects <- c("Extreme temperature", "Flood", "Storm")
secondary_effects <- c("Glacial lake outburst flood", "Drought", "Wildfire",  "Mass movement (wet)", " Mass movement (dry)")

# Create a new column indicating the effect of the natural disaster related to climate change
full_data <- updated_data %>%
  mutate(climate_change_effect = case_when(
    updated_data$type %in% primary_effects ~ "Primary effect",
    updated_data$type  %in% secondary_effects ~ "Secondary effect",
    TRUE ~ "Not related"
  ))

head(full_data)
```




 


## Data Origins

The data set comes from the **Centre for Research on the Epidemiology of Disasters (CRED)**.  This organisation records every instances of natural disasters since 1900 within the EM-DAT database. This comprehensive open source database complies data from various sources; UN agencies, government agencies, research centers, humanitarian organisations, reinsurance companies and world press agencies. For a full list of sources see the [EM-DAT website](https://doc.emdat.be/docs/data-structure-and-content/emdat-sources/). I chose to download all the information regarding natural disasters between the year 1922 and 2022 totaling `r   nrow(my_data)` disasters. After looking at the data it was clear that the historic record before 2000 was too sparse to stand up against the quality of data recording conducted by CRED since its inception in 2000. Rather than looking at changes over a century using the historic record I have decided to focus on non historic entries of natural disasters which have occurred since 2000.  Natural disaster between the year 2000 and 2022 totals  `r nrow(updated_data)`. 



## Research Questions

* Has there been a change in prevalence of natural disasters types since the year 2000? Particularly has there been an increase in natural disaster related to climate change i.e. flooding?

* What regions are most efffected by natural disasters?




## Variables 


To answer my research questions I am interested in where and when different natural disasters occurred. The following variables are of potential interest in asking these questions:

- **historic** - Was the natural disaster before 2000 (when EM-DAT started recording natural disasters in real time)
- **subgroup** - The disaster subgroup:
  - Geophysical - a hazard cause by tectonic plate movement i.e., earthquakes 
  - Hydrological - a hazard cause by extreme changes in distribution of water such as flooding or drought
  - Meteorlogical - a hazard cause by atmospheric change such as extreme temperature  
  - Climatological - a hazard cause by sustained periods of hot or cold such as wildfires 
  - Bioloigcal - a hazard cause by bacteria viruses etc which effect human health i.e. an epidemic 
extra terrestrial - A hazard caused by asteroids, meteoroids, and comets as they pass near-earth

- **type** - The specific type of disaster i.e., Drought or Earthquake

- **subtype** - More detailed description of the natural disaster i.e., Flash Flood or Lightning

- **iso** -  3-letter code referring to the Country. 

- **country** - Country where the disaster occurred and had an impact

- **subregion** - Subregion where the disaster occurred

- **region** - Region or continent where the disaster occurred

- **location** - Geographical location name as specified in the sources, e.g., city name

- **year**

- **month** 

- **day** 

- **climate_change_effect** - whether the natural disaster is a primary effect of climate change, secondary effect of climate change or unrelated to climate change. Categorized based on [EU report](https://www.europarl.europa.eu/meetdocs/2004_2009/documents/dv/ieep_cc_natural_disasters_/ieep_cc_natural_disasters_en.pdf). 

 

*for further explanation of each variable see the [codebook](https://doc.emdat.be/docs/data-structure-and-content/emdat-public-table/) provided by the EM-DATA database*



 
```{r include = FALSE}
#summary of number of disaster per subgroup
full_data %>% group_by(subgroup) %>% summarise(count = n())

#summary of number of disasters per subgroup per type
full_data %>% group_by(subgroup, type) %>% summarise(count = n())


#summary of number of disasters per subtype
full_data %>% group_by(subtype) %>% summarise(count = n())
# this variable may be to specific for the scope of my question


#summary of number of disasters per region 
full_data %>% group_by(region) %>% summarise(count = n())

#summary of number of disasters per region per subregion
full_data %>% group_by(region, country) %>% summarise(count = n())

#summary of number of disaster per year 
full_data %>% group_by(year, region) %>% summarise(count = n())

 


```

```{r echo=FALSE}
graph_example <- full_data %>% group_by(subgroup, subtype, region, climate_change_effect) %>% summarise(count = n())
view(graph_example)

#disaster by region - simple
ggplot(graph_example, aes(x = region, y = count)) +
  geom_bar(stat = "identity", position = "dodge", fill = "dark green") +
  labs(title = "Number of natural disasters between 2000 - 2022",
       y = "Number of Disasters",
       x = "Types of Disasters") +
  ylim(0,1000) +
  theme_classic() 

#by type
ggplot(graph_example, aes(x = subgroup, y = count)) +
  geom_bar(stat = "identity", position = "dodge", fill = "dark green") +
  labs(title = "Number of natural disasters between 2000 - 2022",
       y = "Number of Disasters",
       x = "Types of Disasters") +
  ylim(0,1000) +
  theme_classic() 


#build up graph - split by region 
ggplot(graph_example, aes(x = subgroup, y = count, fill = region)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Number of natural disasters between 2000-2022",
       y = "Number of Disasters",
       x = "Types of Disasters") +
  ylim(0,1000) +
  theme_classic() 


#total number of natural disaster per region split by  climate change 
ggplot(graph_example, aes(x = region, y = count, fill = climate_change_effect)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Number of natural disasters between 2000-2022",
       y = "Number of Disasters",
       x = "Types of Disasters",
       fill = "climate change effect") +
  ylim(0,1000) +
  theme_classic() 



```




* Has there been a change in prevalence of natural disasters types since the year 2000? Particularly has there been an increase in natural disaster related to climate change e.g. flooding?


```{r echo=FALSE}

#TOTALS NOT SPLIT BY REGION
#want a line graph which charts changes in prevalence over time split by the 3 conditions. 
# graph where x is years, y is prevalance, split with climate change
overall_disaster <- full_data %>%
  group_by(year) %>%
  summarise(total_disasters = n())

plot1 <- 
    ggplot(full_data, aes(x = year, y = after_stat(count), color = climate_change_effect)) +
  geom_line(stat = "count") +
    geom_line(data = overall_disaster, aes(y = total_disasters, color = "Total Disasters")) +
  labs(x = "Year", y = "Prevalence", color = "Climate Change Effect") +
  ggtitle("Prevalence of Natural Disasters from 2000 - 2022") +
  theme_minimal() 
   interactive_plot1 <- ggplotly(plot1)
   
     interactive_plot1
#want a line graph which charts in prevelance over time splut by the types of natural disasters 
   # graph where x is years, y is prevalance, split with type
   t_disasters <- full_data %>%
  group_by(year) %>%
  summarise(total_disasters = n())

plot2 <- 
  ggplot(full_data, aes(x = year, y = after_stat(count), color = subgroup)) +
    geom_line(stat = "count") +
    geom_line(data = t_disasters, aes(y = total_disasters, color = "Total Disasters")) +
    labs(x = "Year", y = "Prevalence", color = "subgroup", linetype = "Legend") +
    ggtitle("Prevalence of Natural Disasters from 2000 - 2022") +
    theme_minimal() +
    scale_color_manual(values = c("grey", "red", "orange", "black", "green", "pink", "purple")) 

interactive_plot2 <- ggplotly(plot2)
interactive_plot2

plot3 <- ggplot(full_data, aes(x = year, y = after_stat(count), color = type)) +
  geom_line(stat = "count") +
    geom_line(data = t_disasters, aes(y = total_disasters, color = "Total Disasters")) +
  labs(x = "Year", y = "Prevalence", color = "type of disaster") +
  ggtitle("Prevalence of Natural Disasters from 2000 - 2022 by specific type of disaster") +
  theme_minimal()

interactive_plot3 <- ggplotly(plot3)
interactive_plot3
```

 


* What regions have experienced the most natural disasters since the year 2000? Has this changed over time?

```{r echo=FALSE}
#split by region 


total_disasters <- full_data %>%
  group_by(year, region) %>%
  summarise(count = n())

 

#plot the same climate change graphs now split by region
plot1.2 <- ggplot(full_data, aes(x = year, y = after_stat(count), color = climate_change_effect)) +
    geom_line(stat = "count") +
    geom_line(data = total_disasters, aes(y = count, color = "Total Disasters")) +
    labs(x = "Year", y = "Prevalence", color = "Climate Change Effect", linetype = "Legend") +
    ggtitle("Prevalence of Natural Disasters from 2000 - 2022") +
    theme_minimal() +
    scale_color_manual(values = c("grey", "red", "orange", "black")) +
    facet_wrap(~ region, scales = "free_x", nrow = 3)
    
    
    
    

# Show interactive plot
interactive_plot1.2 <- ggplotly(plot1.2)
interactive_plot1.2

plot2.2 <- ggplot(full_data, aes(x = year, y = after_stat(count), color = subgroup)) +
    geom_line(stat = "count") +
    geom_line(data = total_disasters, aes(y = count, color = "Total Disasters")) +
    labs(x = "Year", y = "Prevalence", color = "subgroup", linetype = "Legend") +
    ggtitle("Prevalence of Natural Disasters from 2000 - 2022") +
    theme_minimal() +
    facet_wrap(~ region, scales = "free_x", nrow = 3)
    
   
    
    

# Show interactive plot
interactive_plot2.2 <- ggplotly(plot2.2)
interactive_plot2.2

plot3.2 <- ggplot(full_data, aes(x = year, y = after_stat(count), color = type)) +
    geom_line(stat = "count") +
    geom_line(data = total_disasters, aes(y = count, color = "Total Disasters")) +
    labs(x = "Year", y = "Prevalence", color = "type", linetype = "Legend") +
    ggtitle("Prevalence of Natural Disasters from 2000 - 2022") +
    theme_classic() +
    facet_wrap(~ region, scales = "free_x", nrow = 3)
    
  
    
    

# Show interactive plot
interactive_plot3.2 <- ggplotly(plot3.2)
interactive_plot3.2



```

 

 
 
```{r echo=FALSE}
 breakdown <- full_data %>% group_by(year, region, type, climate_change_effect) %>%
  summarise(count = n())

 

 plot_a <- ggplot(breakdown, aes(x = year, y = count, fill = interaction(type, climate_change_effect))) +
  geom_bar(stat = "identity") +
  labs(title = "Count of Observations by Year and Other Variables",
       x = "Year",
       y = "Count",
       fill = "Combination of Type, Climate Change Effect") +
   facet_wrap(~ region)
 
 
interactive_plot_a <- ggplotly(plot_a)
interactive_plot_a
 

 plot_b <- ggplot(breakdown, aes(x = year, y = count, fill = type)) +
  geom_bar(stat = "identity") +
  labs(title = "Count of Observations by Year and Other Variables",
       x = "Year",
       y = "Count",
       fill = "Combination of Type, Climate Change Effect") +
   facet_wrap(~ climate_change_effect)
 
 interactive_plot_b <- ggplotly(plot_b)
interactive_plot_b
```

 
  
 
 
